# MagicNav Docker Compose 配置
# 用于本地开发和生产部署

version: '3.8'

services:
  # MagicNav 应用服务
  app:
    build: .
    ports:
      - "3000:3000"  # 主机端口:容器端口
    environment:
      ########################################################
      # 必填环境变量 - 用户必须替换以下值
      ########################################################
      - NODE_ENV=production
      - NEXTAUTH_URL=http://localhost:3000  # 替换为你的域名，如 https://magicnav.example.com
      - NEXTAUTH_SECRET=your_nextauth_secret_here  # 生成一个随机字符串，用于加密会话
      - DATABASE_URL=postgresql://user:password@host:5432/database  # 替换为你的数据库连接 URL
      
      ########################################################
      # 可选环境变量 - 根据需要填写
      ########################################################
      - NEXT_PUBLIC_APP_URL=http://localhost:3000  # 替换为你的域名
      - NEXT_PUBLIC_GOOGLE_ANALYTICS_ID=  # 可选，Google Analytics ID
      - NEXT_PUBLIC_CLARITY_ID=  # 可选，Microsoft Clarity ID
    restart: unless-stopped
    depends_on:
      - db  # 如果使用外部数据库，可以删除此行
    # 可选：挂载日志目录
    # volumes:
    #   - ./logs:/app/logs

  # 可选：PostgreSQL 数据库服务
  # 注意：如果你使用外部数据库（如 Neon、Supabase 等），可以删除整个 db 服务配置
  db:
    image: postgres:15-alpine  # 使用 PostgreSQL 15 Alpine 镜像
    ports:
      - "5432:5432"  # 主机端口:容器端口
    environment:
      ########################################################
      # 数据库环境变量 - 用户必须替换以下值
      ########################################################
      - POSTGRES_USER=your_db_user  # 替换为你的数据库用户名
      - POSTGRES_PASSWORD=your_db_password  # 替换为你的数据库密码
      - POSTGRES_DB=your_db_name  # 替换为你的数据库名称
    volumes:
      - postgres_data:/var/lib/postgresql/data  # 持久化数据库数据
    restart: unless-stopped
    # 可选：限制数据库资源
    # deploy:
    #   resources:
    #     limits:
    #       cpus: '1.0'
    #       memory: '1G'

# 数据卷定义
volumes:
  postgres_data:  # 用于持久化 PostgreSQL 数据
    driver: local  # 使用本地数据卷驱动